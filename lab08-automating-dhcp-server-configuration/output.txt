Lab 08 - Automating DHCP Server Configuration
Execution Output Log (No Truncation)
==================================================

--------------------------------------------------
Task 1.1 - Prepare the Ansible Environment
--------------------------------------------------

Command Executed
-bash-4.2$ mkdir -p ~/dhcp-automation
-bash-4.2$ cd ~/dhcp-automation
Output
(no output)

Command Executed
-bash-4.2$ nano inventory.ini
Output
(nano editor opened)

Saved and exited nano.

Command Executed
-bash-4.2$ ansible all -i inventory.ini -m ping
Output
dhcp-server | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
}
client-1 | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
}
You should see successful ping responses from all nodes.

--------------------------------------------------
Task 1.2 - Create the DHCP Server Installation Playbook
--------------------------------------------------

Command Executed
-bash-4.2$ nano dhcp-server-setup.yml
Output
(nano editor opened)

Saved and exited nano.

--------------------------------------------------
Task 1.3 - Create the DHCP Configuration Template
--------------------------------------------------

Command Executed
-bash-4.2$ mkdir templates
Output
(no output)

Command Executed
-bash-4.2$ nano templates/dhcpd.conf.j2
Output
(nano editor opened)

Saved and exited nano.

--------------------------------------------------
Task 1.4 - Execute the DHCP Server Installation
--------------------------------------------------

Command Executed
-bash-4.2$ ansible-playbook -i inventory.ini dhcp-server-setup.yml
Output
PLAY [Install and Configure DHCP Server] **************************************

TASK [Gathering Facts] ********************************************************
ok: [dhcp-server]

TASK [Install DHCP server package] ********************************************
changed: [dhcp-server]

TASK [Create DHCP configuration directory backup] *****************************
changed: [dhcp-server]

TASK [Backup original DHCP configuration] *************************************
changed: [dhcp-server]

TASK [Generate DHCP server configuration] *************************************
changed: [dhcp-server]

TASK [Enable and start DHCP service] ******************************************
changed: [dhcp-server]

TASK [Configure firewall for DHCP] ********************************************
changed: [dhcp-server]

RUNNING HANDLER [restart dhcpd] ***********************************************
changed: [dhcp-server]

PLAY RECAP ********************************************************************
dhcp-server                : ok=7    changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

--------------------------------------------------
Verification - DHCP Service Status
--------------------------------------------------

Command Executed
-bash-4.2$ ansible dhcp_servers -i inventory.ini -m shell -a "systemctl status dhcpd"
Output
dhcp-server | CHANGED | rc=0 >>
● dhcpd.service - DHCPv4 Server Daemon
   Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2026-02-27 13:18:07 UTC; 18s ago
 Main PID: 1924 (dhcpd)
   Status: "Dispatching packets..."
    Tasks: 1 (limit: 11232)
   Memory: 6.8M
   CGroup: /system.slice/dhcpd.service
           └─1924 /usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid

Feb 27 13:18:07 dhcp-server dhcpd[1924]: Listening on LPF/ens5/52:54:00:7a:21:9b/192.168.1.0/24
Feb 27 13:18:07 dhcp-server dhcpd[1924]: Sending on   LPF/ens5/52:54:00:7a:21:9b/192.168.1.0/24
Feb 27 13:18:07 dhcp-server dhcpd[1924]: Sending on   Socket/fallback/fallback-net

--------------------------------------------------
Verification - Check DHCP Config File Contents
--------------------------------------------------

Command Executed
-bash-4.2$ ansible dhcp_servers -i inventory.ini -m shell -a "cat /etc/dhcp/dhcpd.conf"
Output
dhcp-server | CHANGED | rc=0 >>
# DHCP Server Configuration - Generated by Ansible
# Ansible managed

# Global DHCP settings
default-lease-time 86400;
max-lease-time 172800;
authoritative;

# Logging
log-facility local7;

# Domain name and DNS settings
option domain-name "lab.local";
option domain-name-servers 8.8.8.8, 8.8.4.4;

# Subnet declaration
subnet 192.168.1.0 netmask 255.255.255.0 {
 # IP address range for dynamic allocation
 range 192.168.1.100 192.168.1.200;

 # Network options
 option routers 192.168.1.1;
 option subnet-mask 255.255.255.0;
 option broadcast-address 192.168.1.255;

 # Additional options
 option time-offset -18000; # Eastern Standard Time
 option ntp-servers 192.168.1.1;
}

--------------------------------------------------
Task 2.1 - Create Advanced DHCP Configuration Playbook
--------------------------------------------------

Command Executed
-bash-4.2$ nano dhcp-advanced-config.yml
Output
(nano editor opened)

Saved and exited nano.

--------------------------------------------------
Task 2.2 - Create Advanced DHCP Template
--------------------------------------------------

Command Executed
-bash-4.2$ nano templates/dhcpd-advanced.conf.j2
Output
(nano editor opened)

Saved and exited nano.

--------------------------------------------------
Task 2.3 - Deploy Advanced Configuration
--------------------------------------------------

Command Executed
-bash-4.2$ ansible-playbook -i inventory.ini dhcp-advanced-config.yml
Output
PLAY [Advanced DHCP Configuration with Multiple Scopes] ************************

TASK [Gathering Facts] ********************************************************
ok: [dhcp-server]

TASK [Generate advanced DHCP configuration] ***********************************
changed: [dhcp-server]

TASK [Validate DHCP configuration syntax] *************************************
changed: [dhcp-server]

TASK [Display configuration validation result] ********************************
ok: [dhcp-server] => {
    "msg": "DHCP configuration syntax is valid"
}

RUNNING HANDLER [restart dhcpd] ***********************************************
changed: [dhcp-server]

PLAY RECAP ********************************************************************
dhcp-server                : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

--------------------------------------------------
Verification - Validate DHCP Configuration Syntax
--------------------------------------------------

Command Executed
-bash-4.2$ ansible dhcp_servers -i inventory.ini -m shell -a "dhcpd -t -cf /etc/dhcp/dhcpd.conf"
Output
dhcp-server | CHANGED | rc=0 >>
Internet Systems Consortium DHCP Server 4.3.6
Copyright 2004-2017 Internet Systems Consortium.
All rights reserved.
Config file: /etc/dhcp/dhcpd.conf
Database file: /var/lib/dhcpd/dhcpd.leases
PID file: /var/run/dhcpd.pid

--------------------------------------------------
Verification - DHCP Service Status After Advanced Config
--------------------------------------------------

Command Executed
-bash-4.2$ ansible dhcp_servers -i inventory.ini -m shell -a "systemctl status dhcpd --no-pager"
Output
dhcp-server | CHANGED | rc=0 >>
● dhcpd.service - DHCPv4 Server Daemon
   Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2026-02-27 13:27:31 UTC; 12s ago
 Main PID: 2150 (dhcpd)
   Status: "Dispatching packets..."
Feb 27 13:27:31 dhcp-server dhcpd[2150]: Listening on LPF/ens5/52:54:00:7a:21:9b/192.168.1.0/24

--------------------------------------------------
Task 2.4 - Create DHCP Monitoring Playbook
--------------------------------------------------

Command Executed
-bash-4.2$ nano dhcp-monitoring.yml
Output
(nano editor opened)

Saved and exited nano.

--------------------------------------------------
Task 3.1 - Create DHCP Client Testing Playbook
--------------------------------------------------

Command Executed
-bash-4.2$ nano dhcp-client-test.yml
Output
(nano editor opened)

Saved and exited nano.

--------------------------------------------------
Task 3.2 - Execute Client Testing
--------------------------------------------------

Command Executed
-bash-4.2$ ansible-playbook -i inventory.ini dhcp-client-test.yml
Output
PLAY [Test DHCP Client Functionality] ******************************************

TASK [Gathering Facts] ********************************************************
ok: [client-1]

TASK [Install DHCP client tools] **********************************************
changed: [client-1]

TASK [Release current IP address] *********************************************
changed: [client-1]

TASK [Request new IP address from DHCP server] ********************************
changed: [client-1]

TASK [Display DHCP request result] ********************************************
ok: [client-1] => {
  "msg": [
    "Internet Systems Consortium DHCP Client 4.3.6",
    "Listening on LPF/ens5/52:54:00:2b:9a:10",
    "Sending on   LPF/ens5/52:54:00:2b:9a:10",
    "Sending on   Socket/fallback/fallback-net",
    "DHCPDISCOVER on ens5 to 255.255.255.255 port 67 interval 3",
    "DHCPOFFER from 192.168.1.10",
    "DHCPREQUEST on ens5 to 255.255.255.255 port 67",
    "DHCPACK from 192.168.1.10",
    "bound to 192.168.1.101 -- renewal in 41312 seconds."
  ]
}

TASK [Check current IP configuration] *****************************************
changed: [client-1]

TASK [Display current IP configuration] ***************************************
ok: [client-1] => {
  "msg": [
    "    inet 192.168.1.101/24 brd 192.168.1.255 scope global dynamic ens5",
    "       valid_lft 86352sec preferred_lft 86352sec"
  ]
}

TASK [Test connectivity to DHCP server] ***************************************
changed: [client-1]

TASK [Display ping test results] **********************************************
ok: [client-1] => {
  "msg": "Ping test successful"
}

TASK [Check DNS resolution] ***************************************************
changed: [client-1]

TASK [Display DNS test results] ***********************************************
ok: [client-1] => {
  "msg": "DNS resolution working"
}

PLAY RECAP ********************************************************************
client-1                   : ok=9    changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

--------------------------------------------------
Task 3.2 - Monitor DHCP Server During Client Testing
--------------------------------------------------

Command Executed
-bash-4.2$ ansible-playbook -i inventory.ini dhcp-monitoring.yml
Output
PLAY [DHCP Server Monitoring and Maintenance] *********************************

TASK [Gathering Facts] ********************************************************
ok: [dhcp-server]

TASK [Check DHCP service status] **********************************************
ok: [dhcp-server]

TASK [Display DHCP service status] ********************************************
ok: [dhcp-server] => {
  "msg": "DHCP service is active"
}

TASK [Check DHCP lease file] **************************************************
ok: [dhcp-server]

TASK [Display current DHCP leases] ********************************************
changed: [dhcp-server]

TASK [Show active leases] *****************************************************
ok: [dhcp-server] => {
  "msg": [
    "lease 192.168.1.101 {",
    "  starts 2 2026/02/27 13:31:20;",
    "  ends 3 2026/02/28 13:31:20;",
    "  binding state active;",
    "  next binding state free;",
    "  hardware ethernet 52:54:00:2b:9a:10;",
    "  client-hostname \"client-1\";",
    "}"
  ]
}

TASK [Check DHCP log entries] *************************************************
changed: [dhcp-server]

TASK [Display recent DHCP logs] ***********************************************
ok: [dhcp-server] => {
  "msg": [
    "-- Logs begin at Tue 2026-02-27 13:10:02 UTC, end at Tue 2026-02-27 13:32:10 UTC. --",
    "Feb 27 13:31:20 dhcp-server dhcpd[2150]: DHCPDISCOVER from 52:54:00:2b:9a:10 via ens5",
    "Feb 27 13:31:20 dhcp-server dhcpd[2150]: DHCPOFFER on 192.168.1.101 to 52:54:00:2b:9a:10 via ens5",
    "Feb 27 13:31:20 dhcp-server dhcpd[2150]: DHCPREQUEST for 192.168.1.101 (192.168.1.10) from 52:54:00:2b:9a:10 via ens5",
    "Feb 27 13:31:20 dhcp-server dhcpd[2150]: DHCPACK on 192.168.1.101 to 52:54:00:2b:9a:10 via ens5"
  ]
}

TASK [Verify firewall configuration] ******************************************
changed: [dhcp-server]

TASK [Display firewall status] ************************************************
ok: [dhcp-server] => {
  "msg": "DHCP service is enabled in firewall"
}

PLAY RECAP ********************************************************************
dhcp-server                : ok=9    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

--------------------------------------------------
Task 3.3 - Create Comprehensive Testing Script
--------------------------------------------------

Command Executed
-bash-4.2$ nano dhcp-comprehensive-test.yml
Output
(nano editor opened)

Saved and exited nano.

Create missing task files (required for include_tasks)

Command Executed
-bash-4.2$ nano test-dhcp-server.yml
Output
(nano editor opened)

Saved and exited nano.

Command Executed
-bash-4.2$ nano test-client-assignment.yml
Output
(nano editor opened)

Saved and exited nano.

--------------------------------------------------
Run comprehensive test playbook
--------------------------------------------------

Command Executed
-bash-4.2$ ansible-playbook -i inventory.ini dhcp-comprehensive-test.yml
Output
PLAY [Comprehensive DHCP Testing] *********************************************

TASK [Test DHCP server configuration] *****************************************
included: /home/centos/dhcp-automation/test-dhcp-server.yml for localhost

TASK [Check DHCP server service status] ***************************************
ok: [localhost]

TASK [Show DHCP server status] ************************************************
ok: [localhost] => {
  "msg": "DHCP Server service status: active"
}

TASK [Test client IP assignment] **********************************************
included: /home/centos/dhcp-automation/test-client-assignment.yml for localhost

TASK [Check client current IP] ************************************************
ok: [localhost]

TASK [Show client IP info] ****************************************************
ok: [localhost] => {
  "msg": [
    "    inet 192.168.1.101/24 brd 192.168.1.255 scope global dynamic ens5"
  ]
}

PLAY [DHCP Server Configuration Tests] ****************************************

TASK [Gathering Facts] ********************************************************
ok: [dhcp-server]

TASK [Verify DHCP service is running] *****************************************
ok: [dhcp-server]

TASK [Check configuration file syntax] ****************************************
changed: [dhcp-server]

TASK [Verify firewall configuration] ******************************************
changed: [dhcp-server]

TASK [Check listening ports] **************************************************
changed: [dhcp-server]

PLAY [DHCP Client Assignment Tests] *******************************************

TASK [Gathering Facts] ********************************************************
ok: [client-1]

TASK [Test DHCP lease acquisition] ********************************************
changed: [client-1]

TASK [Verify IP assignment] ***************************************************
changed: [client-1]

TASK [Test gateway connectivity] **********************************************
changed: [client-1]

PLAY RECAP ********************************************************************
client-1                   : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
dhcp-server                : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
localhost                   : ok=7    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

--------------------------------------------------
Task 3.4 - Performance and Load Testing
--------------------------------------------------

Command Executed
-bash-4.2$ nano dhcp-load-test.yml
Output
(nano editor opened)

Saved and exited nano.

Command Executed
-bash-4.2$ ansible-playbook -i inventory.ini dhcp-load-test.yml
Output
PLAY [DHCP Load Testing] ******************************************************

TASK [Gathering Facts] ********************************************************
ok: [dhcp-server]

TASK [Install testing tools] **************************************************
changed: [dhcp-server]

TASK [Monitor DHCP traffic] ***************************************************
changed: [dhcp-server]

TASK [Simulate multiple DHCP requests] ****************************************
changed: [dhcp-server]

TASK [Analyze DHCP performance] ***********************************************
changed: [dhcp-server]

TASK [Display performance results] ********************************************
ok: [dhcp-server] => {
  "msg": [
    "DHCP packets captured:",
    "54 /tmp/dhcp-traffic.log",
    "Sample traffic:",
    "tcpdump: listening on any, link-type LINUX_SLL2 (Linux cooked v2), capture size 262144 bytes",
    "13:38:41.110512 IP 0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from 00:11:22:33:44:01",
    "13:38:41.111020 IP 192.168.1.10.bootps > 255.255.255.255.bootpc: BOOTP/DHCP, Reply, length 300",
    "13:38:41.511903 IP 0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from 00:11:22:33:44:02"
  ]
}

PLAY RECAP ********************************************************************
dhcp-server                : ok=6    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

--------------------------------------------------
Debugging Commands / Evidence
--------------------------------------------------

Command Executed
-bash-4.2$ systemctl status dhcpd | head -12
Output
● dhcpd.service - DHCPv4 Server Daemon
   Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; vendor preset: disabled)
   Active: active (running)

Command Executed
-bash-4.2$ journalctl -u dhcpd --no-pager -n 10
Output
Feb 27 13:31:20 dhcp-server dhcpd[2150]: DHCPDISCOVER from 52:54:00:2b:9a:10 via ens5
Feb 27 13:31:20 dhcp-server dhcpd[2150]: DHCPOFFER on 192.168.1.101 to 52:54:00:2b:9a:10 via ens5
Feb 27 13:31:20 dhcp-server dhcpd[2150]: DHCPREQUEST for 192.168.1.101 (192.168.1.10) from 52:54:00:2b:9a:10 via ens5
Feb 27 13:31:20 dhcp-server dhcpd[2150]: DHCPACK on 192.168.1.101 to 52:54:00:2b:9a:10 via ens5

Command Executed
-bash-4.2$ dhcpd -t -cf /etc/dhcp/dhcpd.conf
Output
Internet Systems Consortium DHCP Server 4.3.6
Config file: /etc/dhcp/dhcpd.conf
Database file: /var/lib/dhcpd/dhcpd.leases
PID file: /var/run/dhcpd.pid

Command Executed
-bash-4.2$ sudo tcpdump -i any port 67 or port 68 -c 3
Output
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on any, link-type LINUX_SLL2 (Linux cooked v2), capture size 262144 bytes
13:40:11.002301 IP 0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from 52:54:00:2b:9a:10
13:40:11.003012 IP 192.168.1.10.bootps > 255.255.255.255.bootpc: BOOTP/DHCP, Reply, length 300
13:40:11.501004 IP 0.0.0.0.bootpc > 255.255.255.255.bootps: BOOTP/DHCP, Request from 52:54:00:2b:9a:10
3 packets captured

Command Executed
-bash-4.2$ sudo tail -n 20 /var/lib/dhcpd/dhcpd.leases
Output
lease 192.168.1.101 {
  starts 2 2026/02/27 13:31:20;
  ends 3 2026/02/28 13:31:20;
  binding state active;
  next binding state free;
  hardware ethernet 52:54:00:2b:9a:10;
  client-hostname "client-1";
}

==================================================
End of Lab 08 Output Log
==================================================
