# Advanced DHCP Server Configuration
# {{ ansible_managed }}
# Generated on {{ ansible_date_time.iso8601 }}

# Global settings
authoritative;
log-facility local7;

# Default lease times
default-lease-time 86400;
max-lease-time 172800;

# Global options
option domain-name-servers 8.8.8.8, 8.8.4.4;

{% for scope in dhcp_scopes %}
# {{ scope.name | upper }} SCOPE
subnet {{ scope.subnet }} netmask {{ scope.netmask }} {
 # Dynamic IP range
 range {{ scope.range_start }} {{ scope.range_end }};

 # Network configuration
 option routers {{ scope.gateway }};
 option subnet-mask {{ scope.netmask }};
 option domain-name "{{ scope.domain_name }}";
 option domain-name-servers {% for dns in scope.dns_servers %}{{ dns }}{% if not loop.last %}, {% endif %}{% endfor %};

 # Lease time for this scope
 default-lease-time {{ scope.lease_time }};
 max-lease-time {{ scope.lease_time * 2 }};

 # Additional options
 option time-offset -18000;
 option ntp-servers {{ scope.gateway }};
}
{% endfor %}

# Static IP reservations
{% for reservation in static_reservations %}
host {{ reservation.name }} {
 hardware ethernet {{ reservation.mac_address }};
 fixed-address {{ reservation.ip_address }};
 option host-name "{{ reservation.hostname }}";
}
{% endfor %}

# Logging configuration
log-facility local7;

# Additional classes and options
class "pxe-clients" {
 match if substring (option vendor-class-identifier, 0, 9) = "PXEClient";
 next-server 192.168.1.1;
 filename "pxelinux.0";
}
