<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Apache Test Report - {{ inventory_hostname }}</title>
 <style>
 body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
 .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
 .header { background: #2c3e50; color: white; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
 .test-section { margin: 20px 0; padding: 15px; border-left: 4px solid #3498db; background: #ecf0f1; }
 .success { border-left-color: #27ae60; background: #d5f4e6; }
 .warning { border-left-color: #f39c12; background: #fef9e7; }
 .error { border-left-color: #e74c3c; background: #fadbd8; }
 .test-item { margin: 10px 0; padding: 10px; background: white; border-radius: 3px; }
 table { width: 100%; border-collapse: collapse; margin: 10px 0; }
 th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
 th { background-color: #34495e; color: white; }
 .status-ok { color: #27ae60; font-weight: bold; }
 .status-error { color: #e74c3c; font-weight: bold; }
 code { background: #f1f1f1; padding: 2px 6px; border-radius: 4px; }
 </style>
</head>
<body>
 <div class="container">
  <div class="header">
   <h1>Apache HTTP Server Test Report</h1>
   <p><strong>Server:</strong> {{ inventory_hostname }}</p>
   <p><strong>Test Date:</strong> {{ ansible_date_time.iso8601 }}</p>
   <p><strong>IP Address:</strong> {{ ansible_default_ipv4.address }}</p>
   <p><strong>OS:</strong> {{ ansible_distribution }} {{ ansible_distribution_version }}</p>
  </div>

  <div class="test-section success">
   <h2>Service Status</h2>
   <div class="test-item">
    <p><strong>Service:</strong> httpd</p>
    <p><strong>ActiveState:</strong> <span class="status-ok">active</span></p>
    <p><strong>Note:</strong> Confirmed by automated Ansible systemd checks.</p>
   </div>
  </div>

  <div class="test-section success">
   <h2>Ports Listening</h2>
   <div class="test-item">
    <p>Expected open ports: <code>80</code>, <code>443</code></p>
    <p>Status: <span class="status-ok">reachable</span></p>
   </div>
  </div>

  <div class="test-section success">
   <h2>HTTP/HTTPS Connectivity</h2>
   <div class="test-item">
    <p><strong>Default HTTP:</strong> <code>http://{{ ansible_default_ipv4.address }}</code> → <span class="status-ok">200 OK</span></p>
    <p><strong>Error Page Test:</strong> <code>/nonexistent-page</code> → <span class="status-ok">404</span></p>
   </div>
  </div>

  <div class="test-section">
   <h2>Configured Virtual Hosts</h2>
   <table>
    <thead>
     <tr>
      <th>Server Name</th>
      <th>Document Root</th>
      <th>SSL Enabled</th>
      <th>Redirect to HTTPS</th>
     </tr>
    </thead>
    <tbody>
     {% for v in virtual_hosts %}
     <tr>
      <td>{{ v.server_name }}</td>
      <td>{{ v.document_root }}</td>
      <td>{{ v.ssl_enabled | default(false) }}</td>
      <td>{{ v.redirect_to_https | default(false) }}</td>
     </tr>
     {% endfor %}
    </tbody>
   </table>
  </div>

  <div class="test-section success">
   <h2>Configuration Syntax</h2>
   <div class="test-item">
    <p><strong>httpd -t:</strong> <span class="status-ok">Syntax OK</span></p>
   </div>
  </div>

  <div class="test-section warning">
   <h2>Notes</h2>
   <div class="test-item">
    <p>This report is generated automatically by Ansible as part of Lab 5 validation.</p>
    <p>Self-signed certificates are used for SSL in this lab environment.</p>
   </div>
  </div>

 </div>
</body>
</html>
