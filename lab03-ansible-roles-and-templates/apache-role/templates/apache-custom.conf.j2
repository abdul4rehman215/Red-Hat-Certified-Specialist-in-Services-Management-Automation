# Custom Apache Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

# Server configuration
ServerName {{ apache_server_name }}
ServerAdmin {{ apache_admin_email }}

# Listen on specified port
Listen {{ apache_port }}

# Virtual Host Configuration
<VirtualHost *:{{ apache_port }}>
 ServerName {{ apache_server_name }}
 DocumentRoot {{ apache_document_root }}

 # Logging
 ErrorLog logs/{{ ansible_hostname }}_error.log
 CustomLog logs/{{ ansible_hostname }}_access.log combined

 # Directory permissions
 <Directory "{{ apache_document_root }}">
 Options Indexes FollowSymLinks
 AllowOverride None
 Require all granted
 </Directory>

 # Security headers
 Header always set X-Content-Type-Options nosniff
 Header always set X-Frame-Options DENY
 Header always set X-XSS-Protection "1; mode=block"
</VirtualHost>

# Server information
ServerTokens Prod
ServerSignature Off

# Performance tuning
{% if ansible_memtotal_mb > 1024 %}
# High memory server configuration
StartServers 8
MinSpareServers 5
MaxSpareServers 20
MaxRequestWorkers 256
{% else %}
# Low memory server configuration
StartServers 2
MinSpareServers 2
MaxSpareServers 10
MaxRequestWorkers 150
{% endif %}
