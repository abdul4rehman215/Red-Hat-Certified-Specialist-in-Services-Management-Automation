# Squid Configuration File - Managed by Ansible
# Generated on {{ ansible_date_time.iso8601 }}
# Network and Port Configuration
http_port {{ squid_port }}
# Cache Directory Configuration
cache_dir ufs {{ squid_cache_dir }} {{ squid_cache_size }} 16 256
# Memory Cache Settings
cache_mem 256 MB
maximum_object_size_in_memory 512 KB
maximum_object_size 1024 MB
# Access Control Lists (ACLs)
acl localnet src 0.0.0.1-0.255.255.255 # RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8 # RFC 1918 local private network (LAN)
acl localnet src 100.64.0.0/10 # RFC 6598 shared address space (CGN)
acl localnet src 169.254.0.0/16 # RFC 3927 link-local (directly plugged machines)
acl localnet src 172.16.0.0/12 # RFC 1918 local private network (LAN)
acl localnet src 192.168.0.0/16 # RFC 1918 local private network (LAN)
acl localnet src fc00::/7 # RFC 4193 local private network range
acl localnet src fe80::/10 # RFC 4291 link-local (directly plugged machines)
# Custom allowed networks
{% for network in allowed_networks %}
acl allowed_nets src {{ network }}
{% endfor %}
# Standard ACLs
acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT
# Access Rules
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow allowed_nets
http_access allow localhost
http_access deny all
# Cache Management
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 20% 4320
# Logging Configuration
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log
# Performance Tuning
dns_nameservers 8.8.8.8 8.8.4.4
fqdncache_size 1024
ipcache_size 1024
# Security Headers
request_header_access Referer deny all
request_header_access X-Forwarded-For deny all
request_header_access Via deny all
request_header_access Cache-Control deny all
# Coredump directory
coredump_dir /var/spool/squid
# Leave coredumps in the first cache dir
coredump_dir {{ squid_cache_dir }}
