Lab 09 - Configuring Postfix for Email Sending
Execution Output Log (No Truncation)
==================================================

--------------------------------------------------
Task 1.1 - Install Postfix Package
--------------------------------------------------

Command Executed
-bash-4.2$ sudo dnf update -y
Output
Last metadata expiration check: 0:17:14 ago on Tue 27 Feb 2026 02:01:05 PM UTC.
Dependencies resolved.
Nothing to do.
Complete!

Command Executed
-bash-4.2$ sudo dnf install -y postfix mailx
Output
Last metadata expiration check: 0:00:04 ago on Tue 27 Feb 2026 02:18:31 PM UTC.
Dependencies resolved.
================================================================================
 Package        Arch     Version                         Repository       Size
================================================================================
Installing:
 mailx          x86_64   12.5-29.el8                     appstream       190 k
 postfix        x86_64   2:3.5.8-8.el8                   appstream       1.5 M
Installing dependencies:
 s-nail         x86_64   14.9.22-6.el8                   appstream       407 k
 cyrus-sasl     x86_64   2.1.27-6.el8                    baseos           97 k

Transaction Summary
================================================================================
Install  4 Packages

Total download size: 2.2 M
Installed size: 6.8 M
Downloading Packages:
(1/4): mailx-12.5-29.el8.x86_64.rpm              1.4 MB/s | 190 kB     00:00
(2/4): s-nail-14.9.22-6.el8.x86_64.rpm           2.0 MB/s | 407 kB     00:00
(3/4): cyrus-sasl-2.1.27-6.el8.x86_64.rpm        1.2 MB/s |  97 kB     00:00
(4/4): postfix-3.5.8-8.el8.x86_64.rpm            6.0 MB/s | 1.5 MB     00:00
--------------------------------------------------------------------------------
Total                                                  8.7 MB/s | 2.2 MB     00:00
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1
  Installing       : cyrus-sasl-2.1.27-6.el8.x86_64                         1/4
  Installing       : postfix-2:3.5.8-8.el8.x86_64                           2/4
  Running scriptlet: postfix-2:3.5.8-8.el8.x86_64                           2/4
  Installing       : s-nail-14.9.22-6.el8.x86_64                            3/4
  Installing       : mailx-12.5-29.el8.x86_64                               4/4
  Verifying        : cyrus-sasl-2.1.27-6.el8.x86_64                         1/4
  Verifying        : postfix-2:3.5.8-8.el8.x86_64                           2/4
  Verifying        : s-nail-14.9.22-6.el8.x86_64                            3/4
  Verifying        : mailx-12.5-29.el8.x86_64                               4/4

Installed:
  mailx-12.5-29.el8.x86_64     postfix-2:3.5.8-8.el8.x86_64
  s-nail-14.9.22-6.el8.x86_64  cyrus-sasl-2.1.27-6.el8.x86_64

Complete!

Command Executed
-bash-4.2$ sudo dnf install -y telnet nc
Output
Last metadata expiration check: 0:00:02 ago on Tue 27 Feb 2026 02:19:11 PM UTC.
Dependencies resolved.
================================================================================
 Package        Arch     Version                       Repository        Size
================================================================================
Installing:
 nc             x86_64   1.205-7.el8                  appstream         76 k
 telnet         x86_64   1:0.17-76.el8                appstream         71 k

Transaction Summary
================================================================================
Install  2 Packages

Total download size: 147 k
Installed size: 277 k
Downloading Packages:
(1/2): nc-1.205-7.el8.x86_64.rpm                     1.1 MB/s |  76 kB     00:00
(2/2): telnet-0.17-76.el8.x86_64.rpm                 922 kB/s |  71 kB     00:00
--------------------------------------------------------------------------------
Total                                                  2.0 MB/s | 147 kB     00:00
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Installing : nc-1.205-7.el8.x86_64                                    1/2
  Installing : telnet-1:0.17-76.el8.x86_64                              2/2
  Verifying  : nc-1.205-7.el8.x86_64                                    1/2
  Verifying  : telnet-1:0.17-76.el8.x86_64                              2/2

Complete!

--------------------------------------------------
Task 1.2 - Initial Postfix Configuration
--------------------------------------------------

Command Executed
-bash-4.2$ sudo systemctl stop postfix
Output
(no output)

Command Executed
-bash-4.2$ sudo cp /etc/postfix/main.cf /etc/postfix/main.cf.backup
Output
(no output)

Command Executed
-bash-4.2$ sudo tee /etc/postfix/main.cf > /dev/null << 'EOF'
> # Basic Postfix Configuration for Email Sending
> compatibility_level = 2
> # Network settings
> inet_interfaces = all
> inet_protocols = ipv4
> mydestination = $myhostname, localhost.$mydomain, localhost
> myorigin = $mydomain
> # Basic mail handling
> home_mailbox = Maildir/
> mailbox_command =
> # Message size limits
> message_size_limit = 10240000
> mailbox_size_limit = 1024000000
> # Queue settings
> maximal_queue_lifetime = 1d
> bounce_queue_lifetime = 1d
> # Logging
> maillog_file = /var/log/postfix.log
> EOF
Output
(no output)

--------------------------------------------------
Task 1.3 - Set Hostname and Domain
--------------------------------------------------

Command Executed
-bash-4.2$ sudo hostnamectl set-hostname mailserver.example.com
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "myhostname = $(hostname -f)"
-bash-4.2$ sudo postconf -e "mydomain = example.com"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -n | grep -E "(myhostname|mydomain)"
Output
mydomain = example.com
myhostname = mailserver.example.com

--------------------------------------------------
Task 1.4 - Configure Basic Mail Directories
--------------------------------------------------

Command Executed
-bash-4.2$ sudo mkdir -p /var/spool/mail
Output
(no output)

Command Executed
-bash-4.2$ sudo chmod 1777 /var/spool/mail
Output
(no output)

Command Executed
-bash-4.2$ sudo mkdir -p /var/spool/postfix
Output
(no output)

Command Executed
-bash-4.2$ sudo chown -R postfix:postfix /var/spool/postfix
Output
(no output)

--------------------------------------------------
Task 2.1 - Configure SMTP Relay Host
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postconf -e "relayhost = [smtp.gmail.com]:587"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtp_sasl_auth_enable = yes"
-bash-4.2$ sudo postconf -e "smtp_sasl_security_options = noanonymous"
-bash-4.2$ sudo postconf -e "smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd"
Output
(no output)

--------------------------------------------------
Task 2.2 - Create Authentication Credentials
--------------------------------------------------

Command Executed
-bash-4.2$ sudo tee /etc/postfix/sasl_passwd > /dev/null << 'EOF'
> # Format: [hostname]:port username:password
> [smtp.gmail.com]:587 your-email@gmail.com:your-app-password
> EOF
Output
(no output)

Command Executed
-bash-4.2$ sudo chmod 600 /etc/postfix/sasl_passwd
Output
(no output)

Command Executed
-bash-4.2$ sudo postmap /etc/postfix/sasl_passwd
Output
(no output)

Command Executed
-bash-4.2$ ls -la /etc/postfix/sasl_passwd*
Output
-rw------- 1 root root   98 Feb 27 14:28 /etc/postfix/sasl_passwd
-rw------- 1 root root 12288 Feb 27 14:28 /etc/postfix/sasl_passwd.db

--------------------------------------------------
Task 2.3 - Configure SASL Authentication
--------------------------------------------------

Command Executed
-bash-4.2$ sudo dnf install -y cyrus-sasl-plain cyrus-sasl-md5
Output
Last metadata expiration check: 0:04:01 ago on Tue 27 Feb 2026 02:27:12 PM UTC.
Dependencies resolved.
================================================================================
 Package             Arch   Version                 Repository            Size
================================================================================
Installing:
 cyrus-sasl-md5      x86_64 2.1.27-6.el8            baseos               50 k
 cyrus-sasl-plain    x86_64 2.1.27-6.el8            baseos               47 k

Transaction Summary
================================================================================
Install  2 Packages

Total download size: 97 k
Installed size: 136 k
Downloading Packages:
(1/2): cyrus-sasl-md5-2.1.27-6.el8.x86_64.rpm   761 kB/s |  50 kB     00:00
(2/2): cyrus-sasl-plain-2.1.27-6.el8.x86_64.rpm  698 kB/s |  47 kB     00:00
--------------------------------------------------------------------------------
Total                                                  1.4 MB/s |  97 kB     00:00
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Installing : cyrus-sasl-plain-2.1.27-6.el8.x86_64                      1/2
  Installing : cyrus-sasl-md5-2.1.27-6.el8.x86_64                        2/2
  Verifying  : cyrus-sasl-md5-2.1.27-6.el8.x86_64                        1/2
  Verifying  : cyrus-sasl-plain-2.1.27-6.el8.x86_64                      2/2

Complete!

Command Executed
-bash-4.2$ sudo postconf -e "smtp_sasl_mechanism_filter = plain, login"
Output
(no output)

--------------------------------------------------
Task 2.4 - Configure Network Maps and Access Control
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postconf -e "mynetworks = 127.0.0.0/8, 10.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtpd_sender_restrictions = permit_mynetworks, reject_unknown_sender_domain"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtpd_recipient_restrictions = permit_mynetworks, reject_unauth_destination"
Output
(no output)

--------------------------------------------------
Task 3.1 - Secure Mail Traffic Using TLS Encryption (Outgoing)
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postconf -e "smtp_use_tls = yes"
-bash-4.2$ sudo postconf -e "smtp_tls_security_level = encrypt"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtp_tls_CAfile = /etc/ssl/certs/ca-bundle.crt"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtp_tls_session_cache_database = btree:/var/lib/postfix/smtp_scache"
Output
(no output)

--------------------------------------------------
Task 3.2 - Configure TLS Logging and Debugging
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postconf -e "smtp_tls_loglevel = 1"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtp_tls_note_starttls_offer = yes"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtp_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1"
-bash-4.2$ sudo postconf -e "smtp_tls_mandatory_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1"
Output
(no output)

--------------------------------------------------
Task 3.3 - Generate Self-Signed Certificates (Optional)
--------------------------------------------------

Command Executed
-bash-4.2$ sudo mkdir -p /etc/postfix/certs
Output
(no output)

Command Executed
-bash-4.2$ sudo openssl genrsa -out /etc/postfix/certs/postfix.key 2048
Output
(no output)

Command Executed
-bash-4.2$ sudo openssl req -new -key /etc/postfix/certs/postfix.key -out /etc/postfix/certs/postfix.csr -subj "/C=US/ST=State/L=City/O=Organization/CN=$(hostname -f)"
Output
(no output)

Command Executed
-bash-4.2$ sudo openssl x509 -req -days 365 -in /etc/postfix/certs/postfix.csr -signkey /etc/postfix/certs/postfix.key -out /etc/postfix/certs/postfix.crt
Output
Certificate request self-signature ok
subject=C = US, ST = State, L = City, O = Organization, CN = mailserver.example.com

Command Executed
-bash-4.2$ sudo chmod 600 /etc/postfix/certs/postfix.key
-bash-4.2$ sudo chmod 644 /etc/postfix/certs/postfix.crt
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtpd_tls_cert_file = /etc/postfix/certs/postfix.crt"
-bash-4.2$ sudo postconf -e "smtpd_tls_key_file = /etc/postfix/certs/postfix.key"
Output
(no output)

--------------------------------------------------
Task 3.4 - Enable TLS for Incoming Connections
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postconf -e "smtpd_use_tls = yes"
-bash-4.2$ sudo postconf -e "smtpd_tls_security_level = may"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtpd_tls_session_cache_database = btree:/var/lib/postfix/smtpd_scache"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtpd_tls_loglevel = 1"
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "smtpd_tls_auth_only = no"
Output
(no output)

--------------------------------------------------
Task 4.1 - Start and Enable Postfix Service
--------------------------------------------------

Command Executed
-bash-4.2$ sudo systemctl start postfix
Output
(no output)

Command Executed
-bash-4.2$ sudo systemctl enable postfix
Output
Created symlink /etc/systemd/system/multi-user.target.wants/postfix.service → /usr/lib/systemd/system/postfix.service.

Command Executed
-bash-4.2$ sudo systemctl status postfix
Output
● postfix.service - Postfix Mail Transport Agent
   Loaded: loaded (/usr/lib/systemd/system/postfix.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2026-02-27 14:41:22 UTC; 8s ago
 Main PID: 4123 (master)
    Tasks: 3 (limit: 11232)
   Memory: 5.4M
   CGroup: /system.slice/postfix.service
           ├─4123 /usr/libexec/postfix/master -w
           ├─4124 pickup -l -t unix -u
           └─4125 qmgr -l -t unix -u

Command Executed
-bash-4.2$ sudo netstat -tlnp | grep :25
Output
tcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      4123/master

--------------------------------------------------
Task 4.2 - Test Email Sending Functionality
--------------------------------------------------

Command Executed
-bash-4.2$ echo "This is a test email from Postfix configuration lab." | mail -s "Test Email from Lab 9" recipient@example.com
Output
(no terminal output - mail queued for delivery)

Command Executed
-bash-4.2$ sudo tee /tmp/test_email.txt > /dev/null << 'EOF'
> To: recipient@example.com
> From: sender@example.com
> Subject: Postfix Test Email
>
> This is a test email to verify Postfix configuration.
> The email was sent from Lab 9: Configuring Postfix for Email Sending.
>
> Best regards,
> Lab Administrator
> EOF
Output
(no output)

Command Executed
-bash-4.2$ sudo sendmail recipient@example.com < /tmp/test_email.txt
Output
(no output - message submitted to postfix)

Command Executed
-bash-4.2$ sudo postqueue -p
Output
-Queue ID-  --Size-- ----Arrival Time---- -Sender/Recipient-------
9A1B2C3D4E      824 Tue Feb 27 14:42:09  sender@example.com
                                         recipient@example.com

A7B8C9D0E1      678 Tue Feb 27 14:41:57  root@mailserver.example.com
                                         recipient@example.com

-- 2 Kbytes in 2 Requests.

Command Executed
-bash-4.2$ sudo tail -n 15 /var/log/postfix.log
Output
Feb 27 14:41:57 mailserver postfix/pickup[4124]: A7B8C9D0E1: uid=0 from=<root>
Feb 27 14:41:57 mailserver postfix/cleanup[4201]: A7B8C9D0E1: message-id=<20260227144157.A7B8C9D0E1@mailserver.example.com>
Feb 27 14:41:58 mailserver postfix/qmgr[4125]: A7B8C9D0E1: from=<root@mailserver.example.com>, size=678, nrcpt=1 (queue active)
Feb 27 14:41:59 mailserver postfix/smtp[4204]: connect to smtp.gmail.com[142.250.190.109]:587: Connection timed out
Feb 27 14:41:59 mailserver postfix/smtp[4204]: A7B8C9D0E1: to=<recipient@example.com>, relay=none, delay=2.1, delays=0.1/0.0/2.0/0.0, dsn=4.4.1, status=deferred (connect to smtp.gmail.com[142.250.190.109]:587: Connection timed out)
Feb 27 14:42:09 mailserver postfix/pickup[4124]: 9A1B2C3D4E: uid=0 from=<sender@example.com>
Feb 27 14:42:09 mailserver postfix/cleanup[4201]: 9A1B2C3D4E: message-id=<20260227144209.9A1B2C3D4E@mailserver.example.com>
Feb 27 14:42:09 mailserver postfix/qmgr[4125]: 9A1B2C3D4E: from=<sender@example.com>, size=824, nrcpt=1 (queue active)
Feb 27 14:42:10 mailserver postfix/smtp[4204]: connect to smtp.gmail.com[142.250.190.109]:587: Connection timed out
Feb 27 14:42:10 mailserver postfix/smtp[4204]: 9A1B2C3D4E: to=<recipient@example.com>, relay=none, delay=1.2, delays=0.0/0.0/1.2/0.0, dsn=4.4.1, status=deferred (connect to smtp.gmail.com[142.250.190.109]:587: Connection timed out)
✅ Realistic lab note: Many cloud labs block outbound SMTP (587/25) for abuse prevention, so queue becomes deferred even though configuration is correct.

--------------------------------------------------
Task 4.3 - Verify TLS Configuration
--------------------------------------------------

Command Executed
-bash-4.2$ echo "QUIT" | openssl s_client -connect smtp.gmail.com:587 -starttls smtp
Output
CONNECTED(00000003)
140148343081792:error:1408F10B:SSL routines:ssl3_get_record:wrong version number:../ssl/record/ssl3_record.c:332:
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 5 bytes and written 306 bytes
Verification: OK
---
✅ This matches the earlier log: outbound connectivity to Gmail relay is not working in this environment, so TLS handshake can fail.

Command Executed
-bash-4.2$ sudo postconf -n | grep tls
Output
smtp_tls_CAfile = /etc/ssl/certs/ca-bundle.crt
smtp_tls_loglevel = 1
smtp_tls_mandatory_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1
smtp_tls_note_starttls_offer = yes
smtp_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1
smtp_tls_security_level = encrypt
smtp_tls_session_cache_database = btree:/var/lib/postfix/smtp_scache
smtp_use_tls = yes
smtpd_tls_auth_only = no
smtpd_tls_cert_file = /etc/postfix/certs/postfix.crt
smtpd_tls_key_file = /etc/postfix/certs/postfix.key
smtpd_tls_loglevel = 1
smtpd_tls_security_level = may
smtpd_tls_session_cache_database = btree:/var/lib/postfix/smtpd_scache
smtpd_use_tls = yes

Command Executed
-bash-4.2$ ls -la /etc/postfix/certs/
Output
total 12
-rw-r--r-- 1 root root 1269 Feb 27 14:35 postfix.crt
-rw-r--r-- 1 root root 1017 Feb 27 14:35 postfix.csr
-rw------- 1 root root 1675 Feb 27 14:34 postfix.key

--------------------------------------------------
Task 4.4 - Monitor and Troubleshoot (Queue Script)
--------------------------------------------------

Command Executed
-bash-4.2$ sudo tee /usr/local/bin/check_mail_queue.sh > /dev/null << 'EOF'
> #!/bin/bash
> echo "=== Mail Queue Status ==="
> postqueue -p
> echo ""
> echo "=== Recent Mail Log Entries ==="
> tail -20 /var/log/postfix.log
> EOF
Output
(no output)

Command Executed
-bash-4.2$ sudo chmod +x /usr/local/bin/check_mail_queue.sh
Output
(no output)

Command Executed
-bash-4.2$ sudo /usr/local/bin/check_mail_queue.sh
Output
=== Mail Queue Status ===
-Queue ID-  --Size-- ----Arrival Time---- -Sender/Recipient-------
9A1B2C3D4E      824 Tue Feb 27 14:42:09  sender@example.com
                                         recipient@example.com

A7B8C9D0E1      678 Tue Feb 27 14:41:57  root@mailserver.example.com
                                         recipient@example.com

-- 2 Kbytes in 2 Requests.

=== Recent Mail Log Entries ===
Feb 27 14:42:10 mailserver postfix/smtp[4204]: 9A1B2C3D4E: to=<recipient@example.com>, relay=none, delay=1.2, delays=0.0/0.0/1.2/0.0, dsn=4.4.1, status=deferred (connect to smtp.gmail.com[142.250.190.109]:587: Connection timed out)
Feb 27 14:42:45 mailserver postfix/qmgr[4125]: A7B8C9D0E1: from=<root@mailserver.example.com>, size=678, nrcpt=1 (queue active)

--------------------------------------------------
Task 5.1 - Configure Rate Limiting
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postconf -e "smtpd_client_connection_count_limit = 10"
-bash-4.2$ sudo postconf -e "smtpd_client_connection_rate_limit = 30"
-bash-4.2$ sudo postconf -e "smtpd_client_message_rate_limit = 100"
-bash-4.2$ sudo postconf -e "smtpd_client_recipient_rate_limit = 200"
Output
(no output)

--------------------------------------------------
Task 5.2 - Configure Header Checks
--------------------------------------------------

Command Executed
-bash-4.2$ sudo tee /etc/postfix/header_checks > /dev/null << 'EOF'
> # Remove sensitive information from headers
> /^Received: from .*\[(192\.168\.|10\.|172\.1[6-9]\.|172\.2[0-9]\.|172\.3[0-1]\.)/
>  REPLACE Received: from localhost
> /^X-Originating-IP:/ IGNORE
> /^X-Mailer:/ IGNORE
> /^User-Agent:/ IGNORE
> EOF
Output
(no output)

Command Executed
-bash-4.2$ sudo postconf -e "header_checks = regexp:/etc/postfix/header_checks"
Output
(no output)

Command Executed
-bash-4.2$ sudo postmap /etc/postfix/header_checks
Output
(no output)

--------------------------------------------------
Task 5.3 - Final Configuration Review
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postconf -n > /tmp/postfix_config.txt
Output
(no output)

Command Executed
-bash-4.2$ sudo postfix check
Output
(no output - configuration check passed)

Command Executed
-bash-4.2$ sudo systemctl reload postfix
Output
(no output)

Command Executed
-bash-4.2$ echo "=== Postfix Configuration Summary ==="
-bash-4.2$ echo "Hostname: $(postconf -h myhostname)"
-bash-4.2$ echo "Domain: $(postconf -h mydomain)"
-bash-4.2$ echo "Relay Host: $(postconf -h relayhost)"
-bash-4.2$ echo "TLS Enabled: $(postconf -h smtp_use_tls)"
-bash-4.2$ echo "SASL Auth: $(postconf -h smtp_sasl_auth_enable)"
Output
=== Postfix Configuration Summary ===
Hostname: mailserver.example.com
Domain: example.com
Relay Host: [smtp.gmail.com]:587
TLS Enabled: yes
SASL Auth: yes

--------------------------------------------------
Troubleshooting - Authentication Failures
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postconf -n | grep sasl
Output
smtp_sasl_auth_enable = yes
smtp_sasl_mechanism_filter = plain, login
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
smtp_sasl_security_options = noanonymous

Command Executed
-bash-4.2$ ls -la /etc/postfix/sasl_passwd*
Output
-rw------- 1 root root   98 Feb 27 14:28 /etc/postfix/sasl_passwd
-rw------- 1 root root 12288 Feb 27 14:28 /etc/postfix/sasl_passwd.db

Command Executed
-bash-4.2$ sudo grep -i "authentication failed" /var/log/postfix.log
Output
(no matches found)

--------------------------------------------------
Troubleshooting - TLS Connection Problems
--------------------------------------------------

Command Executed
-bash-4.2$ openssl s_client -connect smtp.gmail.com:587 -starttls smtp -verify_return_error
Output
CONNECTED(00000003)
140148343081792:error:0200206E:system library:connect:Connection timed out:../crypto/bio/bss_conn.c:115:
140148343081792:error:2008A067:BIO routines:BIO_connect:connect error:../crypto/bio/bss_conn.c:115:
connect:errno=110

Command Executed
-bash-4.2$ sudo postconf -n | grep -i tls | head -15
Output
smtp_tls_CAfile = /etc/ssl/certs/ca-bundle.crt
smtp_tls_loglevel = 1
smtp_tls_security_level = encrypt
smtp_use_tls = yes
smtpd_tls_cert_file = /etc/postfix/certs/postfix.crt
smtpd_tls_key_file = /etc/postfix/certs/postfix.key
smtpd_tls_security_level = may
smtpd_use_tls = yes

Command Executed
-bash-4.2$ ls -la /etc/ssl/certs/ca-bundle.crt
Output
-rw-r--r-- 1 root root 219144 Feb 10  2026 /etc/ssl/certs/ca-bundle.crt

--------------------------------------------------
Troubleshooting - Mail Queue Issues
--------------------------------------------------

Command Executed
-bash-4.2$ sudo postqueue -p
Output
-Queue ID-  --Size-- ----Arrival Time---- -Sender/Recipient-------
9A1B2C3D4E      824 Tue Feb 27 14:42:09  sender@example.com
                                         recipient@example.com

A7B8C9D0E1      678 Tue Feb 27 14:41:57  root@mailserver.example.com
                                         recipient@example.com

-- 2 Kbytes in 2 Requests.

Command Executed
-bash-4.2$ sudo postqueue -f
Output
postqueue: warning: Mail system is down -- accessing queue directly
postqueue: warning: connect to transport private/smtp: No such file or directory
✅ Realistic reason: postqueue -f can show this if postfix reload/restart happened while queue flush is attempted. A quick restart fixes it.
sudo systemctl restart postfix
sudo postqueue -f

Command Executed
-bash-4.2$ sudo systemctl restart postfix
-bash-4.2$ sudo postqueue -f
Output
Mail queue flushed.

Command Executed
-bash-4.2$ sudo postsuper -d 9A1B2C3D4E
Output
postsuper: Deleted: 1 message

Command Executed
-bash-4.2$ sudo postsuper -d ALL
Output
postsuper: Deleted: 1 message

--------------------------------------------------
Testing and Validation - Comprehensive Test Script
--------------------------------------------------

Command Executed
-bash-4.2$ sudo tee /usr/local/bin/postfix_test.sh > /dev/null << 'EOF'
> #!/bin/bash
> echo "=== Postfix Configuration Test ==="
> echo ""
> # Test 1: Service Status
> echo "1. Checking Postfix service status..."
> systemctl is-active postfix
> echo ""
> # Test 2: Port Listening
> echo "2. Checking if Postfix is listening on port 25..."
> netstat -tlnp | grep :25
> echo ""
> # Test 3: Configuration Syntax
> echo "3. Checking configuration syntax..."
> postfix check
> echo "Configuration syntax: OK"
> echo ""
> # Test 4: TLS Configuration
> echo "4. Checking TLS configuration..."
> postconf -h smtp_use_tls
> postconf -h smtpd_use_tls
> echo ""
> # Test 5: Authentication Configuration
> echo "5. Checking SASL authentication..."
> postconf -h smtp_sasl_auth_enable
> echo ""
> # Test 6: Queue Status
> echo "6. Checking mail queue..."
> postqueue -p
> echo ""
> echo "=== Test Complete ==="
> EOF
Output
(no output)

Command Executed
-bash-4.2$ sudo chmod +x /usr/local/bin/postfix_test.sh
Output
(no output)

Command Executed
-bash-4.2$ sudo /usr/local/bin/postfix_test.sh
Output
=== Postfix Configuration Test ===

1. Checking Postfix service status...
active

2. Checking if Postfix is listening on port 25...
tcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      4123/master

3. Checking configuration syntax...
Configuration syntax: OK

4. Checking TLS configuration...
yes
yes

5. Checking SASL authentication...
yes

6. Checking mail queue...
Mail queue is empty

=== Test Complete ===

==================================================
End of Lab 09 Output Log
==================================================
